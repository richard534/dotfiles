#!/bin/bash

# Update/init all submodules in this repo
git submodule update --init --recursive --remote

########################################

# Check to see if Homebrew is installed -  if not, install it
command -v brew >/dev/null 2>&1 || { echo >&2 "Installing Homebrew Now"; \
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"; }

# Install packages via homebrew
# tmux
if ! brew ls --versions tmux > /dev/null; then
    brew install tmux
fi

# vim (more up-to-date then osx default)
if ! brew ls --versions vim > /dev/null; then
    brew install vim
fi

# diff-so-fancy
if ! brew ls --versions diff-so-fancy > /dev/null; then
    brew install diff-so-fancy
fi

# ripgrep
if ! brew ls --versions ripgrep > /dev/null; then
    brew install ripgrep
fi

# fzf
# To install useful key bindings and fuzzy completion uncomment && run:
# $(brew --prefix)/opt/fzf/install
if ! brew ls --versions fzf > /dev/null; then
    brew install fzf
fi

# tree
if ! brew ls --versions tree > /dev/null; then
    brew install tree
fi

# ctags (universal c-tags)
if ! brew ls --versions ctags > /dev/null; then
    brew install ctags
fi

# tldr
if ! brew ls --versions tldr > /dev/null; then
    brew install tldr
fi

# reattach-to-user-namespace
if ! brew ls --versions reattach-to-user-namespace > /dev/null; then
    brew install reattach-to-user-namespace
fi

# pipenv
if ! brew ls --versions pipenv  > /dev/null; then
    brew install pipenv
fi

# mysql
if ! brew ls --versions mysql  > /dev/null; then
    brew install mysql
fi

# postgres
if ! brew ls --versions postgres > /dev/null; then
    brew install postgres
fi

# nodejs
if ! brew ls --versions node  > /dev/null; then
    brew install node
fi

########################################

# brew casks

# add alternative versions of casks
brew tap homebrew/cask-versions

# java
# brew cask install java # latest
brew cask install java8 # java8

# keepassxc
brew cask install keepassxc

# keycastr
brew cask install keycastr

########################################

# python (pip) packages
pip install virtualenv
pip install jedi
pip install flake8

########################################

# npm packages
npm install --global git-open

########################################

# download oh-my-zsh
git clone https://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh

########################################

# Link dotfiles
# get source directory within which this bash script is located
BASEDIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# vim
ln -s ${BASEDIR}/vimrc ~/.vimrc
ln -s ${BASEDIR}/vim/ ~/.vim

# ctags
ln -s ${BASEDIR}/ctags.d ~/.ctags.d

# tmux
ln -s ${BASEDIR}/tmux.conf ~/.tmux.conf

# zsh/oh-my-zsh
echo "# Put secret zsh config here" > ~/zshrc_local
ln -s ${BASEDIR}/zshrc ~/.zshrc
ln -s ${BASEDIR}/git-custom.zsh ~/.oh-my-zsh/custom/git-custom.zsh
ln -s ${BASEDIR}/docker-custom.zsh ~/.oh-my-zsh/custom/docker-custom.zsh
chsh -s /bin/zsh # set default shell to zsh

# git
ln -s ${BASEDIR}/gitignore_global ~/.gitignore_global
ln -s ${BASEDIR}/gitconfig ~/.gitconfig
rm -rf ~/.git_template
ln -s ${BASEDIR}/git_template/ ~/.git_template

# psql
ln -s ${BASEDIR}/psqlrc ~/.psqlrc

# flake8 (python linter)
ln -s ${BASEDIR}/flake8 ~/.config/flake8

