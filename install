#!/bin/bash

# Update/init all submodules in this repo
git submodule update --init --recursive --remote

########################################

# Check to see if Homebrew is installed, and install it if it is not
command -v brew >/dev/null 2>&1 || { echo >&2 "Installing Homebrew Now"; \
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"; }

# Install packages via homebrew
# tmux
if ! brew ls --versions tmux > /dev/null; then
    brew install tmux
fi

# vim (more up-to-date then osx default)
if ! brew ls --versions vim > /dev/null; then
    brew install vim
fi

# diff-so-fancy
if ! brew ls --versions diff-so-fancy > /dev/null; then
    brew install diff-so-fancy
fi

# ripgrep
if ! brew ls --versions ripgrep > /dev/null; then
    brew install ripgrep
fi

# fzf
# To install useful key bindings and fuzzy completion uncomment && run:
# $(brew --prefix)/opt/fzf/install
if ! brew ls --versions fzf > /dev/null; then
    brew install fzf
fi

# tree
if ! brew ls --versions tree > /dev/null; then
    brew install tree
fi

# ctags (universal c-tags)
if ! brew ls --versions ctags > /dev/null; then
    brew install ctags
fi

# tldr
if ! brew ls --versions tldr > /dev/null; then
    brew install tldr
fi

if ! brew ls --versions reattach-to-user-namespace > /dev/null; then
    brew install reattach-to-user-namespace
fi

########################################

# download oh-my-zsh
git clone https://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh

########################################

# Link dotfiles
# get source directory within which this bash script is located
BASEDIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# vim
ln -s ${BASEDIR}/vimrc ~/.vimrc
ln -s ${BASEDIR}/vim/ ~/.vim

# ctags
ln -s ${BASEDIR}/ctags.d ~/.ctags.d

# tmux
ln -s ${BASEDIR}/tmux.conf ~/.tmux.conf

# zsh/oh-my-zsh
echo "# Put secret zsh config here" > ~/zshrc_local
ln -s ${BASEDIR}/zshrc ~/.zshrc
ln -s ${BASEDIR}/git-custom.zsh ~/.oh-my-zsh/custom/git-custom.zsh
chsh -s /bin/zsh # set default shell to zsh

# git
ln -s ${BASEDIR}/gitignore_global ~/.gitignore_global
ln -s ${BASEDIR}/gitconfig ~/.gitconfig
ln -s ${BASEDIR}/git_template ~/.git_template

